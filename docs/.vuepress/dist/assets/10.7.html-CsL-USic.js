import{_ as c,c as i,a as o,b as a,f as s,d as e,e as p,r as l,o as r}from"./app-DtITwm2S.js";const d="/images/10.7_fig.jpg",u={};function k(g,n){const t=l("RouteLink");return r(),i("div",null,[n[8]||(n[8]=o('<h1 id="_10-7-类型的-string-方法和格式化描述符" tabindex="-1"><a class="header-anchor" href="#_10-7-类型的-string-方法和格式化描述符"><span>10.7 类型的 String() 方法和格式化描述符</span></a></h1><p>当定义了一个有很多方法的类型时，十之八九你会使用 <code>String()</code> 方法来定制类型的字符串形式的输出，换句话说：一种可阅读性和打印性的输出。如果类型定义了 <code>String()</code> 方法，它会被用在 <code>fmt.Printf()</code> 中生成默认的输出：等同于使用格式化描述符 <code>%v</code> 产生的输出。还有 <code>fmt.Print()</code> 和 <code>fmt.Println()</code> 也会自动使用 <code>String()</code> 方法。</p>',2)),a("p",null,[n[1]||(n[1]=s("我们使用")),e(t,{to:"/chapter-2/10.4.html"},{default:p(()=>n[0]||(n[0]=[s("第 10.4 节")])),_:1}),n[2]||(n[2]=s("中程序的类型来进行测试："))]),n[9]||(n[9]=o(`<p>示例 10.22 <a href="examples/chapter_10/method_string.go">method_string.go</a>：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">package</span> main</span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token string">&quot;fmt&quot;</span></span>
<span class="line">	<span class="token string">&quot;strconv&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span> TwoInts <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">	a <span class="token builtin">int</span></span>
<span class="line">	b <span class="token builtin">int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	two1 <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>TwoInts<span class="token punctuation">)</span></span>
<span class="line">	two1<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">12</span></span>
<span class="line">	two1<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">10</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;two1 is: %v\\n&quot;</span><span class="token punctuation">,</span> two1<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;two1 is:&quot;</span><span class="token punctuation">,</span> two1<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;two1 is: %T\\n&quot;</span><span class="token punctuation">,</span> two1<span class="token punctuation">)</span></span>
<span class="line">	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;two1 is: %#v\\n&quot;</span><span class="token punctuation">,</span> two1<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>tn <span class="token operator">*</span>TwoInts<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token string">&quot;(&quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>tn<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>tn<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出：</p><pre><code>two1 is: (12/10)
two1 is: (12/10)
two1 is: *main.TwoInts
two1 is: &amp;main.TwoInts{a:12, b:10}
</code></pre><p>当你广泛使用一个自定义类型时，最好为它定义 <code>String()</code>方法。从上面的例子也可以看到，格式化描述符 <code>%T</code> 会给出类型的完全规格，<code>%#v</code> 会给出实例的完整输出，包括它的字段（在程序自动生成 <code>Go</code> 代码时也很有用）。</p><p><strong>备注</strong></p><p>不要在 <code>String()</code> 方法里面调用涉及 <code>String()</code> 方法的方法，它会导致意料之外的错误，比如下面的例子，它导致了一个无限递归调用（<code>TT.String()</code> 调用 <code>fmt.Sprintf</code>，而 <code>fmt.Sprintf</code> 又会反过来调用 <code>TT.String()</code>），很快就会导致内存溢出：</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> TT <span class="token builtin">float64</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token punctuation">(</span>t TT<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%v&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">t<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>练习 10.12</strong> <a href="exercises/chapter_10/type_string.go">type_string.go</a></p><p>给定结构体类型 <code>T</code>:</p><div class="language-go line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre><code><span class="line"><span class="token keyword">type</span> T <span class="token keyword">struct</span> <span class="token punctuation">{</span></span>
<span class="line">    a <span class="token builtin">int</span></span>
<span class="line">    b <span class="token builtin">float32</span></span>
<span class="line">    c <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>值 <code>t</code>: <code>t := &amp;T{7, -2.35, &quot;abc\\tdef&quot;}</code>。给 T 定义 <code>String()</code>，使得 <code>fmt.Printf(&quot;%v\\n&quot;, t)</code> 输出：<code>7 / -2.350000 / &quot;abc\\tdef&quot;</code>。</p><p><strong>练习 10.13</strong> <a href="exercises/chapter_10/celsius.go">celsius.go</a></p><p>为 <code>float64</code> 定义一个别名类型 <code>Celsius</code>，并给它定义 <code>String()</code>，它输出一个十进制数和 °C 表示的温度值。</p><p><strong>练习 10.14</strong> <a href="exercises/chapter_10/days.go">days.go</a></p><p>为 <code>int</code> 定义一个别名类型 <code>Day</code>，定义一个字符串数组它包含一周七天的名字，为类型 <code>Day</code> 定义 <code>String()</code> 方法，它输出星期几的名字。使用 <code>iota</code> 定义一个枚举常量用于表示一周的中每天（MO、TU...）。</p><p><strong>练习 10.15</strong> <a href="exercises/chapter_10/timezones.go">timezones.go</a></p><p>为 <code>int</code> 定义别名类型 <code>TZ</code>，定义一些常量表示时区，比如 UTC，定义一个 <code>map</code>，它将时区的缩写映射为它的全称，比如：<code>UTC -&gt; &quot;Universal Greenwich time&quot;</code>。为类型 <code>TZ</code> 定义 <code>String()</code> 方法，它输出时区的全称。</p><p><strong>练习 10.16</strong> <a href="exercises/chapter_10/stack_arr.go">stack_arr.go</a> / <a href="exercises/chapter_10/stack_struct.go">stack_struct.go</a></p><p>实现栈 (stack) 数据结构：</p><p><img src="`+d+'" alt=""></p><p>它的格子包含数据，比如整数 <code>i</code>、<code>j</code>、<code>k</code> 和 <code>l</code> 等等，格子从底部（索引 0）至顶部（索引 n）来索引。这个例子中假定 <code>n = 3</code>，那么一共有 4 个格子。</p><p>一个新栈中所有格子的值都是 <code>0</code>。</p><p>将一个新值放到栈的最顶部一个空（包括零）的格子中，这叫做 push。</p><p>获取栈的最顶部一个非空（非零）的格子的值，这叫做 pop。 现在可以理解为什么栈是一个后进先出 (LIFO) 的结构了吧。</p><p>为栈定义一个 <code>Stack</code> 类型，并为它定义 <code>Push</code> 和 <code>Pop</code> 方法，再为它定义 <code>String()</code> 方法（用于调试）输出栈的内容，比如：<code>[0:i] [1:j] [2:k] [3:l]</code>。</p><p>1）<a href="exercises/chapter_10/stack_arr.go">stack_arr.go</a>：使用长度为 4 的 int 数组作为底层数据结构。</p><p>2） <a href="exercises/chapter_10/stack_struct.go">stack_struct.go</a>：使用包含一个索引和一个 <code>int</code> 数组的结构体作为底层数据结构，索引表示第一个空闲的位置。</p><p>3）使用常量 <code>LIMIT</code> 代替上面表示元素个数的 4 重新实现上面的 1）和 2），使它们更具有一般性。</p><h2 id="链接" tabindex="-1"><a class="header-anchor" href="#链接"><span>链接</span></a></h2>',30)),a("ul",null,[a("li",null,[e(t,{to:"/chapter-2/directory.html"},{default:p(()=>n[3]||(n[3]=[s("目录")])),_:1})]),a("li",null,[n[5]||(n[5]=s("上一节：")),e(t,{to:"/chapter-2/10.6.html"},{default:p(()=>n[4]||(n[4]=[s("方法")])),_:1})]),a("li",null,[n[7]||(n[7]=s("下一节：")),e(t,{to:"/chapter-2/10.8.html"},{default:p(()=>n[6]||(n[6]=[s("垃圾回收和 SetFinalizer")])),_:1})])])])}const m=c(u,[["render",k],["__file","10.7.html.vue"]]),b=JSON.parse('{"path":"/chapter-2/10.7.html","title":"10.7 类型的 String() 方法和格式化描述符","lang":"zh-cn","frontmatter":{},"headers":[{"level":1,"title":"10.7 类型的 String() 方法和格式化描述符","slug":"_10-7-类型的-string-方法和格式化描述符","link":"#_10-7-类型的-string-方法和格式化描述符","children":[{"level":2,"title":"链接","slug":"链接","link":"#链接","children":[]}]}],"git":{},"filePathRelative":"chapter-2/10.7.md"}');export{m as comp,b as data};
